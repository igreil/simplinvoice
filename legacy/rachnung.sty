%-----------------------------------------------------------------------------
% The original source files were: rechnung.dtx  (with options: 'package')
%
% Any modified versions of this file must be renamed with new filenames 
% distinct from rechnung.sty.
% 
% This generated file may be distributed as long as the original source files,
% as listed above, are part of the same distribution. (The sources need not 
% necessarily be in the same archive or directory.)
%
% File: rechnung.dtx Copyright (C) 1998 M G Berberich
% berberic@fmi.uni-passau.de
%-----------------------------------------------------------------------------
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{rachnung}
% Forked from BMG Rechnungs Style 3.70 – rechung.sty
% © 1998, 2001 M. G. Berberich, Ulrich Sibiller
% With further contributions by Tom Kazimiers, 
% Sven Schoradt, Lennart Hensler and Stefan Sperling.
%-----------------------------------------------------------------------------
\RequirePackage{siunitx}
	\sisetup{%
				detect-all,
				locale					=	DE,
				group-separator			=	{.},		% => 10.000,00
				group-digits			=	integer,
				group-minimum-digits	=	4,
				input-ignore			=	{.}
	}
%-----------------------------------------------------------------------------
\newcount\@RCHcnt 			\newcount\@RCHsum 			\newcount\@RCHtmp
\newcount\@RCHmwst 			\newcount\@RCHmwsti 		\newcount\@RCHmwstii
\newcount\@RCHtmptmp 		\newcount\@RCHabschln 		\newcount\@RCHabschlb
\newcount\@RCHabschlmwst	
%-----------------------------------------------------------------------------
\newdimen\@RCHPosWidth		\newdimen\@RCHAnzWidth
\newdimen\@RCHArtnumWidth	\newdimen\@RCHArtWidth		\newdimen\@RCHEinzelWidth
\newdimen\@RCHGesamtWidth
%-----------------------------------------------------------------------------
\@RCHPosWidth=1.3em			\@RCHAnzWidth=3.2em			\@RCHArtnumWidth=5em%
\@RCHEinzelWidth=6em		\@RCHGesamtWidth=6.1em	
%-----------------------------------------------------------------------------
\newif\if@RCHerm			\newif\if@RCHabschl			\newif\if@RCHpos
\newif\if@RCHamo			\newif\if@RCHfirst			\newif\if@RCHhor
\newif\if@RCHartnum			\newif\if@RCHinit			

\newdimen\@RCHwdt

\newcommand*\@RCHstsi{19}
\newcommand*\@RCHstsii{7}
\newcommand*\Steuersatz[2]{\def\@RCHstsi{#1}\def\@RCHstsii{#2}}

\newcommand*\@RCHustsi{0}
\newcommand*\@ArtikelPrefix{}
\newcommand*\@AnzahlSuffix{}

\newcommand*\@waehrung{€}

\newcommand*\Waehrung[1]{\def\@waehrung{#1}}

\newcommand*\PositionEin[0]{\if@RCHinit\else\global\@RCHpostrue\fi}
\newcommand*\PositionAus[0]{\if@RCHinit\else\global\@RCHposfalse\fi}
\newcommand*\TrennerEin[0]{\if@RCHinit\else\global\@RCHhortrue\fi}
\newcommand*\TrennerAus[0]{\if@RCHinit\else\global\@RCHhorfalse\fi}
\newcommand*\AnzahlEin[0]{\if@RCHinit\else\global\@RCHamotrue\fi}
\newcommand*\AnzahlAus[0]{\if@RCHinit\else\global\@RCHamofalse\fi}

\newcommand*\TausenderTrennzeichenEin[0]{\sisetup{group-digits=integer}}
\newcommand*\TausenderTrennzeichenAus[0]{\sisetup{group-digits=none}}
\newcommand*\TausenderTrennzeichen[1]{\sisetup{group-separator={#1}}}
\newcommand*\LangDecimalSeparator{,}

\newcommand*\ArtikelPrefix[1]{\def\@ArtikelPrefix{#1}}
\newcommand*\AnzahlEinheit[1]{\def\@AnzahlSuffix{\,#1}}
\newcommand*\Euro{\def\@waehrung{\texteuro}}
\newcommand*\Dollar{\def\@waehrung{\textdollar}\setLeftCurrency}

\newcommand*\Gesamtsumme{\writeCurrency\@RCHsum}
\newcommand*\Mehrwertsteuer{\writeCurrency\@RCHmwst}


\newcommand*\LangPos{Pos}
\newcommand*\LangCount{Anzahl}
\newcommand*\LangArticleId{Art.\,Nr.}
\newcommand*\LangDescription{Beschreibung}
\newcommand*\LangSingleItemPrice{Einzelpreis}
\newcommand*\LangTotalPrice{Gesamtpreis}
\newcommand*\LangShippingFee{Versandkosten}
\newcommand*\LangTotal{Summe}
\newcommand*\LangNet{Nettosumme}
\newcommand*\LangGrossTotal{Bruttosumme}
\newcommand*\LangInvoice{Rechnung}
\newcommand*\LangTaxRate{Steuersatz}
\newcommand*\LangSalesTaxEU{Umsatzsteuer (Innergemeinschaftliche
  Lieferung nach Art. 6 Abs. 1 UStG)}
\newcommand*\LangSalesTaxNoVAT{Umsatzsteuer (MwSt. nicht ausweisbar
    nach \S19 UStG)}
\newcommand*\LangSalesTaxReverseVAT{\parbox[t]{10cm}{Umsatzsteuer
  wird gem.\S3a Abs.  2 UStG nicht erhoben. Die Steuerschuld geht
  auf den Empfänger über.}}
%-----------------------------------------------------------------------------
\newcommand*\@RCHwrite[1]{
  \@tempcnta=#1
  \@tempcntb\@tempcnta
  \divide\@tempcnta100 \expandafter\num\expandafter{\the\@tempcnta}\LangDecimalSeparator%
  \multiply\@tempcnta100\advance\@tempcntb-\@tempcnta
  \ifnum#1<0
    \multiply\@tempcntb-1
  \fi
  \@tempcnta\@tempcntb\divide\@tempcnta10 \the\@tempcnta
  \multiply\@tempcnta10\advance\@tempcntb-\@tempcnta
  \the\@tempcntb
}
%-----------------------------------------------------------------------------

\newcommand*\writeCurrency[1]{\@RCHwrite{#1}\,\@waehrung}
\newcommand*\writebfCurrency[1]{{\fontseries{b}
  \selectfont\writeCurrency{#1}}}
\newcommand*\setLeftCurrency{
  \renewcommand*\writeCurrency[1]{\@waehrung ™\@RCHwrite{##1}}
}
\newcommand*\@readNum[1]{\@RCHtmp=0\@readA#1\relax}
\newcommand*\@readA[1]{%
  \expandafter\if#1\relax\@tempcnta0\@readC\relax
  \else\expandafter\if#1.\@tempcnta0
  \expandafter\expandafter\expandafter\expandafter
  \expandafter\expandafter\expandafter\@readB
  \else\expandafter\if#1,\@tempcnta0
  \expandafter\expandafter\expandafter\expandafter
  \expandafter\expandafter\expandafter\@readB
  \else\multiply\@RCHtmp10\advance\@RCHtmp#1
  \expandafter\expandafter\expandafter\expandafter
  \expandafter\expandafter\expandafter\@readA
  \fi\fi\fi
}
\newcommand*\@readB[1]{%
  \expandafter\if#1\relax\relax
     \ifnum \@tempcnta > 2
       \@RCHtmp0\PackageError{rechnung}{mehr als zwei
       Nachkommastellen gefunden}
     \else
       \ifnum \@tempcnta = 2
       \else
         \ifnum \@tempcnta > 0
   \advance\@tempcnta1
           \multiply\@RCHtmp10
   \@readB\relax
         \else
           \multiply\@RCHtmp100\PackageError{rechnung}{keine
           Nachkommastellen gefunden}
         \fi
       \fi
    \fi
  \else
     \advance\@tempcnta1
     \multiply\@RCHtmp10
     \advance\@RCHtmp#1\expandafter\@readB
  \fi}

\newcommand*\@readC[1]{%
  \expandafter
  \if#1\relax\relax
     \ifnum \@tempcnta > 2
       \@RCHtmp0\PackageError{rechnung}{mehr als zwei
       Nachkommastellen gefunden}
     \fi
     \ifnum \@tempcnta < 2
 \advance\@tempcnta1
         \multiply\@RCHtmp10
 \@readC\relax
     \fi
  \else
     \advance\@tempcnta1
     \multiply\@RCHtmp10
     \advance\@RCHtmp#1\expandafter\@readC
  \fi}
\newcommand*{\writefoot}[0]{
  \if@RCHerm
    \nointerlineskip
    \vskip0.5ex
    \hbox to \textwidth{
      \hfill\footnotesize\strut
      $^*$ Artikel mit \@RCHstsii\,\% Mehrwertsteuer}
  \fi}
\newcommand*\@RCHsline[2]{%
  \goodbreak\nointerlineskip
  \vbox{\hrule
    \hbox to\textwidth{%
      \strut\lsep #1\hfil
      \sep
      \hbox to \@RCHGesamtWidth{\hfil#2}%
      \rsep}%
    \hrule\vskip-0.4pt}}
\newcommand*\@RCHohne{
  \@RCHsline{\LangTotal}{\writebfCurrency\@RCHsum}}
\newcommand*\@RCHnetto{
  \@RCHsline{\LangNet}{\writeCurrency\@RCHsum}%
  \multiply\@RCHmwsti\@RCHstsi
  \advance\@RCHmwsti50\divide\@RCHmwsti100
  \multiply\@RCHmwstii\@RCHstsii
  \advance\@RCHmwstii50\divide\@RCHmwstii100
  \@RCHmwst\@RCHmwsti\advance\@RCHmwst\@RCHmwstii
  \if@RCHerm
    \@RCHsline{zzgl. \@RCHstsii\,\% MwSt.}{\writeCurrency\@RCHmwstii}%
  \fi
  \@RCHsline{zzgl. \@RCHstsi\,\% MwSt.}{\writeCurrency\@RCHmwsti}%
  \advance\@RCHsum\@RCHmwst
  \hrule
  \vskip\doublerulesep\vskip0.4pt
  \@RCHsline{\LangTotal}{\writebfCurrency\@RCHsum}%
  \if@RCHabschl
    \vskip\doublerulesep\vskip10pt
    \advance\@RCHabschlb\@RCHabschln
    \advance\@RCHabschlmwst\@RCHabschln
    \multiply\@RCHabschlmwst\@RCHstsi
    \advance\@RCHmwsti50
    \divide\@RCHabschlmwst100
    \advance\@RCHabschlb\@RCHabschlmwst
    \advance\@RCHmwst-\@RCHabschlmwst
    \@RCHsline{Abschlagszahlung }{\writeCurrency\@RCHabschln}%
    \@RCHsline{zzgl. \@RCHstsi\,\% MwSt. }{\writeCurrency\@RCHabschlmwst}%
    \vskip\doublerulesep\vskip0.4pt
    \@RCHsline{bereits gezahlt }{\writebfCurrency\@RCHabschlb}%
    \advance\@RCHsum-\@RCHabschlb
    \vskip\doublerulesep\vskip10pt
    \@RCHsline{noch zu zahlen }{\writebfCurrency\@RCHsum}%
  \fi
  \hrule
  \writefoot
}
\newcommand*\@RCHkeineUST{
  \@RCHsline{\LangNet}{\writeCurrency\@RCHsum}%
  \@RCHsline{\LangSalesTaxNoVAT}{\writeCurrency\@RCHustsi}
  \hrule
  \vskip\doublerulesep\vskip0.4pt
  \@RCHsline{\LangTotal}{\writebfCurrency\@RCHsum}%
    \if@RCHabschl
      \vskip\doublerulesep\vskip10pt
      \@RCHsline{Abschlagszahlung }{\writeCurrency\@RCHabschln}%
      \@RCHsline{\LangSalesTaxNoVAT}{\writeCurrency\@RCHustsi}
      \advance\@RCHsum-\@RCHabschln
      \vskip\doublerulesep\vskip10pt
      \@RCHsline{noch zu zahlen }{\writebfCurrency\@RCHsum}%
    \fi
  \writefoot
}
\newcommand*\@RCHeuUST{
  \@RCHsline{\LangNet}{\writeCurrency\@RCHsum}%
  \@RCHsline{\LangSalesTaxEU}{\writeCurrency\@RCHustsi}
  \hrule
  \vskip\doublerulesep\vskip0.4pt
  \@RCHsline{\LangTotal}{\writebfCurrency\@RCHsum}%
  \writefoot
}
\newcommand*\@RCHkeineUSTInt{
  \@RCHsline{\LangNet}{\writeCurrency\@RCHsum}%
  \@RCHsline{\LangSalesTaxReverseVAT}{\writeCurrency\@RCHustsi}
  \hrule
  \vskip\doublerulesep\vskip0.4pt
  \@RCHsline{\LangTotal}{\writebfCurrency\@RCHsum}%
  \writefoot
}
\newcommand*\@RCHbrutto{
  \@RCHsline{\LangTotal}{\writebfCurrency\@RCHsum}
  \multiply\@RCHmwsti\@RCHstsi\multiply\@RCHmwsti2%
  \@tempcnta100\advance\@tempcnta\@RCHstsi
  \advance\@RCHmwsti\@tempcnta
  \multiply\@tempcnta2%
  \divide\@RCHmwsti\@tempcnta

  \multiply\@RCHmwstii\@RCHstsii\multiply\@RCHmwstii2%
  \@tempcnta100\advance\@tempcnta\@RCHstsii
  \advance\@RCHmwstii\@tempcnta
  \multiply\@tempcnta2%
  \divide\@RCHmwstii\@tempcnta

  \@RCHmwst\@RCHmwsti\advance\@RCHmwst\@RCHmwstii
  \if@RCHerm
    \@RCHsline{inkl. erm. MwSt. \@RCHstsii\,\%}
    {\writeCurrency\@RCHmwstii}%
  \fi
  \@RCHsline{inkl. \@RCHstsi\,\% MwSt}{\writeCurrency\@RCHmwsti}%
  \writefoot
}

\newcommand*{\sep}[0]{\hskip\tabcolsep\vrule\hskip\tabcolsep}
\newcommand*{\rsep}[0]{\hskip\tabcolsep\vrule}
\newcommand*{\lsep}[0]{\vrule\hskip\tabcolsep}

\newcommand*\@RCHlineX[6]{{
\goodbreak\nointerlineskip
    \vbox{
      \if@RCHhor
\hrule
      \else
        \if@RCHfirst
          \hrule
        \fi
      \fi
      \hbox to\textwidth{%
\lsep%
        \if@RCHpos%
           \hbox to\@RCHPosWidth{\hfil #1\strut}%
           \sep
        \fi% Pos-Spalte
        \if@RCHamo%
           \hbox to\@RCHAnzWidth{\hfil #2\strut}%
           \sep
        \fi% Anzahl-Spalte
        \if@RCHartnum%
          \hbox to\@RCHArtnumWidth{\hfil #3\strut}%
          \sep%
        \fi% Art-Num-Spalte
        \vtop{\normalbaselines%
           \noindent\rightskip=0pt plus1cm%
           \hsize\@RCHwdt%
           \linewidth\hsize#4\null\strut\par}%
        \hfil\sep%Beschreibung
        \if@RCHamo%
           \hbox to\@RCHEinzelWidth{\hfil #5\strut}%
           \sep%
        \fi% Einzelpreis
        \hbox to\@RCHGesamtWidth{\hfil #6\strut}\rsep% Gesamtpreis
      }%hbox
     }%vbox
}}
\newcommand*\@Artikel[4][X]{\@ArtikelX[#1]{#2}{}{#3}{#4}}
\newcommand*\@ArtikelX[5][X]{
  \initRechnung
  \advance\@RCHcnt1%
  \@readNum{#5}
  \@RCHtmptmp=\@RCHtmp%
  \@readNum{#2}\multiply\@RCHtmp\@RCHtmptmp
  \advance\@RCHtmp99\divide\@RCHtmp100%Aufrunden auf 2 Nachkommastellen.
  \@lineBaseX[#1]{\the\@RCHcnt}{#2\@AnzahlSuffix}{#3}{#4}{\writeCurrency\@RCHtmptmp}
}
\newcommand*\@Gutschrift[3][X]{\@GutschriftX[#1]{#2}{#3}}
\newcommand*\@GutschriftX[3][X]{
  \initRechnung
  \advance\@RCHcnt1%
  \@readNum{#3}
  \multiply\@RCHtmp-1
  \@lineBaseX[#1]{\the\@RCHcnt}{\null}{\null}{#2}{\null}
}
\newcommand*\@Versandkosten[2][X]{\@VersandkostenX[#1]{#2}}
\newcommand*\@VersandkostenX[2][X]{
  \initRechnung
  \@readNum{#2}
  \@lineBaseX[#1]{\null}{1}{\null}{\LangShippingFee}{#2\,\@waehrung}
}
\newcommand*\@Abschlagszahlung[2][X]{\@AbschlagszahlungX[#1]{#2}}
\newcommand*\@AbschlagszahlungX[2][X]{
  \initRechnung
  \@readNum{#2}
  \global\@RCHabschltrue
  \global\advance\@RCHabschln\@RCHtmp
}
\newcommand*\@lineBaseX[6][X]{
  \global\advance\@RCHsum\@RCHtmp
  \@RCHlineX{\@ArtikelPrefix#2}{\@ArtikelPrefix#3}{\@ArtikelPrefix#4}{\@ArtikelPrefix#5}{\@ArtikelPrefix#6}{\@ArtikelPrefix\writeCurrency\@RCHtmp
    \expandafter\ifx#1X\else\rlap{$^*$}\fi}
  \expandafter
  \ifx#1X
    \advance\@RCHmwsti\@RCHtmp
  \else
    \advance\@RCHmwstii\@RCHtmp\global\@RCHermtrue
  \fi
  \global\@RCHfirstfalse  %horizontale Linien nur beim ersten Artikel
}
\newenvironment*{Rechnung}[1][X]{\RechnungStart{#1}{}}{\RechnungEnde}
\newenvironment*{Rechnung*}[1][X]{\RechnungStart{#1}{X}}{\RechnungEnde}
\newenvironment*{Bestellung}[0]{\RechnungStart{X}{}}{\RechnungEnde}
\newenvironment*{Bestellung*}[0]{\RechnungStart{X}{X}}{\RechnungEnde}
\newcommand*{\RechnungStart}[2]{
  \@RCHinitfalse
  \@RCHermfalse
  \@RCHabschlfalse
  \@RCHmwsti0
  \@RCHmwstii0
  \@RCHabschln0
  \@RCHabschlb0
  \@RCHabschlmwst0
  \def\@RCHtype{#1}%
  \@RCHcnt0
  \@RCHsum0
  \@RCHwdt\textwidth
  \advance\@RCHwdt-\@RCHAnzWidth    % Breite der Spalte Anz
  \advance\@RCHwdt-\@RCHEinzelWidth% Breite der Spalte EPreis
  \advance\@RCHwdt-\@RCHGesamtWidth % Breite der Spalte GPreis
  \advance\@RCHwdt-2.0pt        % Breite der Spaltentrenner
  \advance\@RCHwdt-8\tabcolsep  % Breite des Abstands zu
                                % den Spaltentrennern

  \global\@RCHfirsttrue
  \global\@RCHpostrue
  \global\@RCHhortrue
  \global\@RCHamotrue
\ifx#2X
  \global\@RCHartnumtrue
  \let\Artikel\@ArtikelX
  \let\Posten\@ArtikelX
  \let\Versandkosten\@VersandkostenX
  \let\Abschlagszahlung\@AbschlagszahlungX
  \let\Gutschrift\@GutschriftX
\else
  \global\@RCHartnumfalse
  \let\Artikel\@Artikel
  \let\Posten\@Artikel
  \let\Versandkosten\@Versandkosten
  \let\Abschlagszahlung\@Abschlagszahlung
  \let\Gutschrift\@Gutschrift
\fi
}
\newcommand*{\initRechnung}[0]
{
  \if@RCHinit
  \else
    \if@RCHpos
      \advance\@RCHwdt-\@RCHPosWidth
      \advance\@RCHwdt-0.4pt
      \advance\@RCHwdt-2\tabcolsep
    \fi
    \unless\if@RCHamo
      \advance\@RCHwdt+\@RCHAnzWidth
      \advance\@RCHwdt+\@RCHEinzelWidth
      \advance\@RCHwdt+0.8pt
      \advance\@RCHwdt+4\tabcolsep
      \renewcommand*{\LangTotalPrice}{Preis}
    \fi
    \if@RCHartnum
      \advance\@RCHwdt-\@RCHArtnumWidth
      \advance\@RCHwdt-0.4pt
      \advance\@RCHwdt-2\tabcolsep
    \fi
    \vskip\abovedisplayskip
    \@RCHlineX{\scriptsize \LangPos}%
              {\scriptsize \LangCount}%
              {\scriptsize \LangArticleId}%
              {\scriptsize \LangDescription\hfill}%
              {\scriptsize \LangSingleItemPrice}%
              {\scriptsize \LangTotalPrice}
    \@RCHinittrue
  \fi
}

\newcommand*{\RechnungEnde}[0]
{
  \hrule
  \vskip\doublerulesep\vskip0.4pt
       \expandafter\if\@RCHtype X \@RCHohne
  \else\expandafter\if\@RCHtype N \@RCHnetto
  \else\expandafter\if\@RCHtype B \@RCHbrutto
  \else\expandafter\if\@RCHtype K \@RCHkeineUST
  \else\expandafter\if\@RCHtype I \@RCHkeineUSTInt
  \else\expandafter\if\@RCHtype E \@RCHeuUST
  \else\PackageError{rechnung}{Unbekannter Rechnungstyp `\@RCHtype'}%
  \fi\fi\fi\fi\fi\fi
  \global\@RCHsum\@RCHsum\global\@RCHmwst\@RCHmwst
  \vskip\belowdisplayskip
}
\endinput
%%
%% End of file `rechnung.sty'.
